<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:Converters="clr-namespace:XiaoZhiSharp_MauiApp.Converters"
             x:Class="XiaoZhiSharp_MauiApp.SettingsPage"
             Title="è®¾ç½®">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- é¡µé¢æ ‡é¢˜ -->
            <VerticalStackLayout Spacing="5">
                <Label Text="ðŸ”§ è¿žæŽ¥è®¾ç½®" FontSize="24" FontAttributes="Bold"/>
                <Label Text="é…ç½®å°æ™ºAIæœåŠ¡å™¨è¿žæŽ¥å‚æ•°" TextColor="Gray" FontSize="14"/>
            </VerticalStackLayout>

            <!-- æœåŠ¡å™¨URLè®¾ç½® -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸŒ" FontSize="24"/>
                        <VerticalStackLayout>
                            <Label Text="æœåŠ¡å™¨URL" FontAttributes="Bold"/>
                            <Label Text="WebSocketæœåŠ¡å™¨è¿žæŽ¥åœ°å€" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    <Entry Text="{Binding ServerUrl}" Placeholder="wss://api.tenclass.net/xiaozhi/v1/"/>
                </VerticalStackLayout>
            </Frame>

            <!-- MACåœ°å€è®¾ç½® -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸ·ï¸" FontSize="24"/>
                        <VerticalStackLayout>
                            <Label Text="MACåœ°å€" FontAttributes="Bold"/>
                            <Label Text="è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    <Entry Text="{Binding DeviceId}" Placeholder="06:FB:BE:44:2D:29"/>
                </VerticalStackLayout>
            </Frame>

            <!-- OTAåœ°å€è®¾ç½® -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸ”„" FontSize="24"/>
                        <VerticalStackLayout>
                            <Label Text="OTAåœ°å€" FontAttributes="Bold"/>
                            <Label Text="è®¾å¤‡æ›´æ–°å’Œé…ç½®æœåŠ¡å™¨åœ°å€" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    <Entry Text="{Binding OtaUrl}" Placeholder="https://api.tenclass.net/xiaozhi/ota/"/>
                </VerticalStackLayout>
            </Frame>

            <!-- OTAçŠ¶æ€ä¿¡æ¯ -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸ“Š" FontSize="24"/>
                        <VerticalStackLayout>
                            <Label Text="OTAçŠ¶æ€ä¿¡æ¯" FontAttributes="Bold"/>
                            <Label Text="è®¾å¤‡è¿žæŽ¥å’Œé…ç½®çŠ¶æ€" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    
                    <BoxView HeightRequest="1" BackgroundColor="#e0e0e0" Margin="0,5"/>
                    
                    <!-- çŠ¶æ€ä¿¡æ¯åˆ—è¡¨ -->
                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*" RowSpacing="8">
                        <Label Grid.Row="0" Grid.Column="0" Text="è¿žæŽ¥çŠ¶æ€:" FontAttributes="Bold"/>
                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding IsConnected, StringFormat='{0}'}" 
                               TextColor="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#51cf66;#ff6b6b'}"/>
                        
                        <Label Grid.Row="1" Grid.Column="0" Text="OTAçŠ¶æ€:" FontAttributes="Bold"/>
                        <Label Grid.Row="1" Grid.Column="1" Text="{Binding OtaStatus}"/>
                        
                        <Label Grid.Row="2" Grid.Column="0" Text="å½“å‰ç‰ˆæœ¬:" FontAttributes="Bold"/>
                        <Label Grid.Row="2" Grid.Column="1" Text="{Binding CurrentVersion}"/>
                        
                        <Label Grid.Row="3" Grid.Column="0" Text="æœ€æ–°ç‰ˆæœ¬:" FontAttributes="Bold" 
                               IsVisible="{Binding LatestVersion, Converter={StaticResource StringToBoolConverter}}"/>
                        <Label Grid.Row="3" Grid.Column="1" Text="{Binding LatestVersion}" 
                               IsVisible="{Binding LatestVersion, Converter={StaticResource StringToBoolConverter}}"/>
                        
                        <Label Grid.Row="4" Grid.Column="0" Text="æ¿€æ´»ç :" FontAttributes="Bold" 
                               IsVisible="{Binding ActivationCode, Converter={StaticResource StringToBoolConverter}}"/>
                        <Label Grid.Row="4" Grid.Column="1" Text="{Binding ActivationCode}" TextColor="#339af0"
                               IsVisible="{Binding ActivationCode, Converter={StaticResource StringToBoolConverter}}"/>
                        
                        <Label Grid.Row="5" Grid.Column="0" Text="æœ€åŽæ£€æŸ¥:" FontAttributes="Bold" 
                               IsVisible="{Binding LastOtaCheckTime, Converter={StaticResource NullToBoolConverter}}"/>
                        <Label Grid.Row="5" Grid.Column="1" Text="{Binding LastOtaCheckTime, StringFormat='{0:yyyy-MM-dd HH:mm:ss}'}" 
                               IsVisible="{Binding LastOtaCheckTime, Converter={StaticResource NullToBoolConverter}}"/>
                    </Grid>
                    
                    <Button Text="ðŸ”„ æ‰‹åŠ¨æ£€æŸ¥OTA" BackgroundColor="#339af0" TextColor="White" 
                            Clicked="OnManualOtaCheckClicked" Margin="0,10,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <!-- VADé˜ˆå€¼è®¾ç½® -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸŽ™ï¸" FontSize="24"/>
                        <VerticalStackLayout>
                            <Label Text="VADé˜ˆå€¼" FontAttributes="Bold"/>
                            <Label Text="è¯­éŸ³æ´»åŠ¨æ£€æµ‹é˜ˆå€¼ (æ¯«ç§’)" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    <Entry Text="{Binding VadThreshold}" Keyboard="Numeric" Placeholder="40"/>
                </VerticalStackLayout>
            </Frame>

            <!-- è°ƒè¯•æ¨¡å¼è®¾ç½® -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True">
                <Grid ColumnDefinitions="*,Auto">
                    <HorizontalStackLayout Grid.Column="0" Spacing="10">
                        <Label Text="ðŸ›" FontSize="24"/>
                        <VerticalStackLayout>
                            <Label Text="è°ƒè¯•æ¨¡å¼" FontAttributes="Bold"/>
                            <Label Text="å¯ç”¨è°ƒè¯•æ—¥å¿—è¾“å‡º" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                    <Switch Grid.Column="1" IsToggled="{Binding IsDebugMode}" VerticalOptions="Center"/>
                </Grid>
            </Frame>

            <!-- è°ƒè¯•æ—¥å¿—æ˜¾ç¤º -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="10" HasShadow="True" 
                   IsVisible="{Binding IsDebugMode}">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*,Auto">
                        <HorizontalStackLayout Grid.Column="0" Spacing="10">
                            <Label Text="ðŸ“‹" FontSize="24"/>
                            <VerticalStackLayout>
                                <Label Text="è°ƒè¯•æ—¥å¿—" FontAttributes="Bold"/>
                                <Label Text="{Binding DebugLogs.Count, StringFormat='å…± {0} æ¡æ—¥å¿—'}" FontSize="12" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                        <Button Grid.Column="1" Text="ðŸ—‘ï¸ æ¸…ç©º" BackgroundColor="Transparent" 
                                TextColor="#ff6b6b" Clicked="OnClearLogsClicked"/>
                    </Grid>
                    
                    <ScrollView HeightRequest="200" BackgroundColor="#f5f5f5">
                        <CollectionView ItemsSource="{Binding DebugLogs}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding}" FontSize="12" Margin="5,2" LineBreakMode="WordWrap"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </ScrollView>
                </VerticalStackLayout>
            </Frame>

            <!-- æ“ä½œæŒ‰é’® -->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10" Margin="0,10">
                <Button Grid.Column="0" Text="ðŸ’¾ ä¿å­˜è®¾ç½®" BackgroundColor="#51cf66" TextColor="White" 
                        Clicked="OnSaveSettingsClicked"/>
                <Button Grid.Column="1" Text="ðŸ”„ åº”ç”¨å¹¶é‡è¿ž" BackgroundColor="#339af0" TextColor="White" 
                        Clicked="OnApplySettingsClicked"/>
                <Button Grid.Column="2" Text="ðŸ”„ æ¢å¤é»˜è®¤" BackgroundColor="#ff6b6b" TextColor="White" 
                        Clicked="OnResetSettingsClicked"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- è½¬æ¢å™¨ -->
            <Converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
            <Converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
            <Converters:StringToBoolConverter x:Key="StringToBoolConverter"/>
            <Converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
</ContentPage> 